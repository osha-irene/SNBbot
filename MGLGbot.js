const fs = require('fs');
const path = require('path'); // âœ… path ëª¨ë“ˆ ì¶”ê°€
const { Client, GatewayIntentBits, REST, Routes, SlashCommandBuilder } = require('discord.js');
require('dotenv').config(); // í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ

const client = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.DirectMessages,
        GatewayIntentBits.MessageContent
    ]
});

// ë°ì´í„° íŒŒì¼ ê²½ë¡œ ì„¤ì •
const dataFilePath = path.join(__dirname, 'data.json');


// ğŸ”¹ ë´‡ ë¡œê·¸ì¸ ì´ë²¤íŠ¸
client.once("ready", () => {
    console.log(`âœ… Logged in as ${client.user.tag}!`);
    registerCommands(); // ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ ë“±ë¡ ì‹¤í–‰
});

// ğŸ”¹ REST APIë¥¼ ì‚¬ìš©í•œ ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ ë“±ë¡
const rest = new REST({ version: '10' }).setToken(process.env.DISCORD_BOT_TOKEN);

async function registerCommands() {
    try {
        await rest.put(
            Routes.applicationCommands(process.env.BOT_ID), // BOT_IDëŠ” .envì— ì €ì¥í•´ì•¼ í•¨
            { body: commands }
        );
        console.log("âœ… ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } catch (error) {
        console.error("âŒ ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ ë“±ë¡ ì‹¤íŒ¨:", error);
    }
}

// ğŸ”¹ ë´‡ ë¡œê·¸ì¸ ì‹¤í–‰
client.login(process.env.DISCORD_BOT_TOKEN);

  // ğŸ”¹ ë´‡ì´ ì„œë²„ì— ì²˜ìŒ ì´ˆëŒ€ë  ë•Œ ë©”ì‹œì§€ ì „ì†¡
client.on('guildCreate', guild => {
    const defaultChannel = guild.systemChannel || guild.channels.cache.find(channel => channel.type === 0);
    if (defaultChannel) {
        defaultChannel.send(
            `âœ… **MGLGbotì´ ì •ìƒì ìœ¼ë¡œ ì´ˆëŒ€ë˜ì—ˆìŠµë‹ˆë‹¤!**  
            ğŸ’¬ ëª…ë ¹ì–´ë¥¼ í™•ì¸í•˜ë ¤ë©´ **\`!ë„ì›€\`**ì„ ì…ë ¥í•˜ì„¸ìš”.`
        );
    }
    });

let characterData = {};
let plotData = {};
let logData = [];

// ë°ì´í„° ë¡œë“œ
if (fs.existsSync(dataFilePath)) {
    characterData = JSON.parse(fs.readFileSync(dataFilePath, 'utf8'));
}
const saveData = () => fs.writeFileSync(dataFilePath, JSON.stringify(characterData, null, 2));
const saveLog = () => fs.writeFileSync("log.json", JSON.stringify(logData, null, 2));

// ğŸ”¹ Slash command for í”Œë¡¯
client.on('interactionCreate', async interaction => {
    if (!interaction.isCommand()) return;

    if (interaction.commandName === 'í”Œë¡¯') {
        // ì…ë ¥ê°’ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ê³  í•„í„°ë§
        const numbers = interaction.options.getString('ê°’')
            .split(' ')
            .map(n => parseInt(n))
            .filter(n => n >= 1 && n <= 6);

        if (numbers.length === 0) {
            return interaction.reply({ content: 'âŒ 1~6 ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.', ephemeral: true });
        }

        // í”Œë¡¯ ì €ì¥
        plotData[interaction.user.id] = numbers;
        await interaction.reply({ content: 'âœ… í”Œë¡¯ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', ephemeral: true });

        // ê³µê°œ ë©”ì‹œì§€ë¡œ "í”Œë¡¯ ì™„ë£Œ" ì¶œë ¥ (message.channel.send â†’ interaction.channel.send ë¡œ ë³€ê²½)
        interaction.channel.send(
            `<@${interaction.user.id}> ë‹˜ì´ í”Œë¡¯ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! í˜„ì¬ í”Œë¡¯ ì°¸ì—¬ì: ${Object.keys(plotData).length}ëª…`
        );
    }
});


client.on('messageCreate', async message => {
    if (message.author.bot) return;

	const args = message.content.match(/"([^"]+)"|\S+/g); // í°ë”°ì˜´í‘œ í¬í•¨ ë¬¸ìì—´ íŒŒì‹±
    const command = args.shift();
	
	// íŠ¹ê¸° ë° ì˜ì—­ ëª©ë¡
const ì˜ì—­ëª©ë¡ = ["ë³„", "ì§ìŠ¹", "í˜", "ë…¸ë˜", "ê¿ˆ", "ì–´ë‘ "];
const íŠ¹ê¸°ëª©ë¡ = [
    ["í™©ê¸ˆ", "ì‚´", "ì¤‘ë ¥", "ì´ì•¼ê¸°", "ì¶”ì–µ", "ì‹¬ì—°"],
    ["ëŒ€ì§€", "ë²Œë ˆ", "ë°”ëŒ", "ì„ ìœ¨", "ìˆ˜ìˆ˜ê»˜ë¼", "ë¶€íŒ¨"],
    ["ìˆ²", "ê½ƒ", "íë¦„", "ëˆˆë¬¼", "ê±°ì§“", "ë°°ì‹ "],
    ["ê¸¸", "í”¼", "ë¬¼", "ì´ë³„", "ë¶ˆì•ˆ", "ë°©í™©"],
    ["ë°”ë‹¤", "ë¹„ëŠ˜", "íŒŒë¬¸", "ë¯¸ì†Œ", "ì ", "ë‚˜íƒœ"],
    ["ì •ì ", "í˜¼ëˆ", "ììœ ", "ë§ˆìŒ", "ìš°ì—°", "ì™œê³¡"],
    ["ë¹„", "ì´ë¹¨", "ì¶©ê²©", "ìŠ¹ë¦¬", "í™˜ê°", "ë¶ˆí–‰"],
    ["í­í’", "ì™¸ì¹¨", "ìš°ë ˆ", "ì‚¬ë‘", "ê´‘ê¸°", "ë°”ë³´"],
    ["íƒœì–‘", "ë¶„ë…¸", "ë¶ˆ", "ì •ì—´", "ê¸°ë„", "ì•…ì˜"],
    ["ì²œê³µ", "ë‚ ê°œ", "ë¹›", "ì¹˜ìœ ", "í¬ë§", "ì ˆë§"],
    ["ì´ê³„", "ì—ë¡œìŠ¤", "ì›í™˜", "ì‹œê°„", "ë¯¸ë˜", "ì£½ìŒ"]
];

const ì˜ì—­ì´ëª¨ì§€ = {
    "ë³„": "ğŸŒŸ",
    "ì§ìŠ¹": "ğŸ¾",
    "í˜": "âš¡",
    "ë…¸ë˜": "ğŸµ",
    "ê¿ˆ": "ğŸ’¤",
    "ì–´ë‘ ": "ğŸŒ‘",
    "ê°€ë³€": "ğŸ²" // ê°€ë³€ íŠ¹ê¸° ì¶”ê°€
};


// ğŸ”¹ ìºë¦­í„° ì…ë ¥ (íŠ¹ê¸° í•„ìˆ˜ ì…ë ¥ + ê¸°ë³¸ ì¥ì„œ ì¶”ê°€)
if (command === '!ì‹œíŠ¸ì…ë ¥') {
    if (args.length < 6) {
        return message.reply('âŒ ì‚¬ìš©ë²•: `!ì‹œíŠ¸ì…ë ¥ [ì´ë¦„] [íŠ¹ê¸°1] [íŠ¹ê¸°2] [íŠ¹ê¸°3] [íŠ¹ê¸°4] [íŠ¹ê¸°5]` (íŠ¹ê¸° 5ê°œ í•„ìˆ˜)');
    }

    const name = args.shift();
    const íŠ¹ê¸°ëª©ë¡ = args.slice(0, 5);

    characterData[message.author.id] = { 
        ì´ë¦„: name,
        íŠ¹ê¸°: íŠ¹ê¸°ëª©ë¡,
        ì›í˜•: null,
        ëŠ¥ë ¥ì¹˜: { ê³µê²©ë ¥: 3, ë°©ì–´ë ¥: 3, ê·¼ì›ë ¥: 3 },
        ì¥ì„œ: {
            "ê¸´ê¸‰ ì†Œí™˜": {
                íŒì •íŠ¹ê¸°: "ê°€ë³€",
                ë‚´ìš©: "1D6ì„ êµ´ë ¤ ë¶„ì•¼ë¥¼ ë¬´ì‘ìœ„ë¡œ ì •í•˜ê³ , ê·¸ ë’¤ì— 2D6ì„ êµ´ë ¤ ë¬´ì‘ìœ„ë¡œ íŠ¹ê¸° í•˜ë‚˜ë¥¼ ì„ íƒí•œë‹¤. ê·¸ê²ƒì´ ì§€ì •íŠ¹ê¸°ê°€ ëœë‹¤. í•´ë‹¹ íŠ¹ê¸°ë¡œ íŒì •ì— ì„±ê³µí•˜ë©´ ê·¸ íŠ¹ê¸°ì— ëŒ€ì‘í•˜ëŠ” ì •ë ¹ 1ê°œì²´ë¥¼ ì†Œí™˜í•  ìˆ˜ ìˆë‹¤."
            }
        },
        ì˜ì—­: null,
        ì•µì»¤: {}
    };

    saveData();
    message.reply(`âœ… ìºë¦­í„° **${name}**ì´(ê°€) ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.  
ğŸ”¹ **íŠ¹ê¸°**: ${íŠ¹ê¸°ëª©ë¡.join(', ')}  
ğŸ“– ê¸°ë³¸ ì¥ì„œ **"ê¸´ê¸‰ ì†Œí™˜"**ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

   // ğŸ”¹ ìºë¦­í„° ë°ì´í„° ìë™ ì´ˆê¸°í™” í•¨ìˆ˜
    function initializeCharacter(userId) {
        if (!characterData[userId]) {
            characterData[userId] = { ì›í˜•: {}, ëŠ¥ë ¥ì¹˜: { ê³µê²©ë ¥: 3, ë°©ì–´ë ¥: 3, ê·¼ì›ë ¥: 3 } };
        }
        if (!characterData[userId].ëŠ¥ë ¥ì¹˜) {
            characterData[userId].ëŠ¥ë ¥ì¹˜ = { ê³µê²©ë ¥: 3, ë°©ì–´ë ¥: 3, ê·¼ì›ë ¥: 3 };
        }
	}

    // ğŸ”¹ ì˜ì—­ ì„¤ì •
    if (command === '!ì˜ì—­') {
        const ì˜ì—­ = args[0];
        if (!ì˜ì—­ëª©ë¡.includes(ì˜ì—­)) return message.reply('âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì˜ì—­ì…ë‹ˆë‹¤. (ë³„, ì§ìŠ¹, í˜, ë…¸ë˜, ê¿ˆ, ì–´ë‘  ì¤‘ ì„ íƒ)');
        if (!characterData[message.author.id]) characterData[message.author.id] = {};
        characterData[message.author.id].ì˜ì—­ = ì˜ì—­;
        saveData();
        message.reply(`âœ… ì˜ì—­ì´ **${ì˜ì—­}**(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ğŸ”¹ íŠ¹ê¸° ì„¤ì •
    if (command === '!íŠ¹ê¸°ì„¤ì •') {
        if (args.length !== 5) return message.reply('âŒ 5ê°œì˜ íŠ¹ê¸°ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
        if (!characterData[message.author.id]) characterData[message.author.id] = {};
        characterData[message.author.id].íŠ¹ê¸° = args;
        saveData();
        message.reply(`âœ… íŠ¹ê¸°ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ${args.join(', ')}`);
    }

    // ğŸ”¹ íŠ¹ê¸° í™•ì¸
    if (command === '!íŠ¹ê¸°í™•ì¸') {
        const char = characterData[message.author.id];
        if (!char || !char.íŠ¹ê¸°) return message.reply('âŒ ì„¤ì •ëœ íŠ¹ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        message.reply(`ğŸ“ í˜„ì¬ íŠ¹ê¸°: ${char.íŠ¹ê¸°.join(', ')}`);
    }


// ğŸ”¹ í˜¼ì˜ íŠ¹ê¸° ì„¤ì •
if (command === '!í˜¼ì˜íŠ¹ê¸°') {
    if (!characterData[message.author.id]) {
        return message.reply('âŒ ë¨¼ì € `!ì‹œíŠ¸ì…ë ¥`ìœ¼ë¡œ ìºë¦­í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
    }
    
    if (args.length !== 1) {
        return message.reply('âŒ ì‚¬ìš©ë²•: `!í˜¼ì˜íŠ¹ê¸° [íŠ¹ê¸°ëª…]` (í•œ ë‹¨ì–´ë¡œ ì…ë ¥í•˜ì„¸ìš”)');
    }

    const í˜¼ì˜íŠ¹ê¸° = args[0];

    // ê¸°ì¡´ íŠ¹ê¸° ëª©ë¡ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    const ëª¨ë“ íŠ¹ê¸° = íŠ¹ê¸°ëª©ë¡.flat(); // 2D ë°°ì—´ì„ 1D ë°°ì—´ë¡œ ë³€í™˜
    if (ëª¨ë“ íŠ¹ê¸°.includes(í˜¼ì˜íŠ¹ê¸°)) {
        return message.reply(`âŒ **${í˜¼ì˜íŠ¹ê¸°}**ëŠ” ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íŠ¹ê¸°ì…ë‹ˆë‹¤! í˜¼ì˜ íŠ¹ê¸°ëŠ” ê¸°ì¡´ íŠ¹ê¸°ì™€ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.`);
    }

    // ìºë¦­í„° ë°ì´í„°ì— í˜¼ì˜ íŠ¹ê¸° ì €ì¥
    characterData[message.author.id].í˜¼ì˜íŠ¹ê¸° = í˜¼ì˜íŠ¹ê¸°;
    saveData();

    message.reply(`**í˜¼ì˜ íŠ¹ê¸°**ê°€ **"${í˜¼ì˜íŠ¹ê¸°}"**(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.  
ğŸ’  ì´ íŠ¹ê¸°ì˜ ëª©í‘œê°’ì€ í•­ìƒ **6**ì…ë‹ˆë‹¤.`);
}


// ğŸ”¹ í˜¼ì˜ íŠ¹ê¸° í™•ì¸
if (command === '!í˜¼íŠ¹í™•ì¸') {
    const char = characterData[message.author.id];
    if (!char || !char.í˜¼ì˜íŠ¹ê¸°) {
        return message.reply('âŒ ì„¤ì •ëœ í˜¼ì˜ íŠ¹ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    message.reply(`ğŸ’  **í˜¼ì˜ íŠ¹ê¸°**: ${char.í˜¼ì˜íŠ¹ê¸°}`);
}
// ğŸ”¹ íŒì • ê¸°ëŠ¥ (í˜¼ì˜ íŠ¹ê¸° & ì›í˜• ì ìš©)
if (command === '!íŒì •') {
    if (!characterData[message.author.id]) {
        return message.reply('âŒ ë¨¼ì € `!ì‹œíŠ¸ì…ë ¥`ìœ¼ë¡œ ìºë¦­í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
    }

    let ì›í˜•ì‚¬ìš© = false;
    let ì›í˜•ì´ë¦„ = null;
    let íŒì •íŠ¹ê¸° = null;

    if (args.length === 1) {
        íŒì •íŠ¹ê¸° = args[0];
    } else if (args.length === 2) {
        ì›í˜•ì´ë¦„ = args[0].replace(/"/g, '');
        íŒì •íŠ¹ê¸° = args[1];
        ì›í˜•ì‚¬ìš© = true;
    } else {
        return message.reply('âŒ ì‚¬ìš©ë²•: `!íŒì • [íŠ¹ê¸°]` ë˜ëŠ” `!íŒì • "ì›í˜•ëª…" [íŠ¹ê¸°]`');
    }

    const char = characterData[message.author.id];

    // ğŸ¯ í˜¼ì˜ íŠ¹ê¸° íŒì • (ëª©í‘œê°’ 6 ê³ ì •)
    if (char.í˜¼ì˜íŠ¹ê¸° === íŒì •íŠ¹ê¸°) {
        ëª©í‘œê°’ = 6;
    } else {
        // ğŸ¯ ì¼ë°˜ íŠ¹ê¸° ê±°ë¦¬ íŒì •
        let íŠ¹ê¸°ì¢Œí‘œ = null;
        for (let i = 0; i < íŠ¹ê¸°ëª©ë¡.length; i++) {
            for (let j = 0; j < íŠ¹ê¸°ëª©ë¡[i].length; j++) {
                if (íŠ¹ê¸°ëª©ë¡[i][j] === íŒì •íŠ¹ê¸°) {
                    íŠ¹ê¸°ì¢Œí‘œ = { x: i, y: j };
                    break;
                }
            }
            if (íŠ¹ê¸°ì¢Œí‘œ) break;
        }

        if (!íŠ¹ê¸°ì¢Œí‘œ) {
            return message.reply(`âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŠ¹ê¸°ì…ë‹ˆë‹¤: **${íŒì •íŠ¹ê¸°}**`);
        }

        let ëª©í‘œê°’ = 5;
        if (!char.íŠ¹ê¸°.includes(íŒì •íŠ¹ê¸°)) {
            let ìµœì†Œê±°ë¦¬ = 99;
            for (const myíŠ¹ê¸° of char.íŠ¹ê¸°) {
                for (let i = 0; i < íŠ¹ê¸°ëª©ë¡.length; i++) {
                    for (let j = 0; j < íŠ¹ê¸°ëª©ë¡[i].length; j++) {
                        if (íŠ¹ê¸°ëª©ë¡[i][j] === myíŠ¹ê¸°) {
                            let ê±°ë¦¬ = Math.abs(i - íŠ¹ê¸°ì¢Œí‘œ.x) + Math.abs(j - íŠ¹ê¸°ì¢Œí‘œ.y) * 2;
                            if (char.ì˜ì—­ && (íŠ¹ê¸°ì¢Œí‘œ.y === j || íŠ¹ê¸°ì¢Œí‘œ.y === j - 1 || íŠ¹ê¸°ì¢Œí‘œ.y === j + 1)) {
                                ê±°ë¦¬ = Math.abs(i - íŠ¹ê¸°ì¢Œí‘œ.x) + Math.abs(j - íŠ¹ê¸°ì¢Œí‘œ.y);
                            }
                            ìµœì†Œê±°ë¦¬ = Math.min(ìµœì†Œê±°ë¦¬, ê±°ë¦¬);
                        }
                    }
                }
            }
            ëª©í‘œê°’ = 5 + ìµœì†Œê±°ë¦¬;
        }
    }

    // ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
    const dice1 = Math.floor(Math.random() * 6) + 1;
    const dice2 = Math.floor(Math.random() * 6) + 1;
    const diceRoll = dice1 + dice2;
    const ì„±ê³µì—¬ë¶€ = diceRoll >= ëª©í‘œê°’ ? 'âœ… **ì„±ê³µ!**' : 'âŒ **ì‹¤íŒ¨!**';

    // ğŸ“œ íŒì • ê²°ê³¼ ì¶œë ¥
    if (ì›í˜•ì‚¬ìš©) {
        if (!char.ì›í˜• || char.ì›í˜•.ì´ë¦„ !== ì›í˜•ì´ë¦„) {
            return message.reply(`âŒ ë‹¹ì‹ ì˜ ì›í˜• **"${ì›í˜•ì´ë¦„}"**(ì€)ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        }
        message.reply(`2D6>=${ëª©í‘œê°’} **${íŒì •íŠ¹ê¸°} íŒì •** (ì›í˜•: ${ì›í˜•ì´ë¦„}) ğŸ²`);
    } else {
        message.reply(`2D6>=${ëª©í‘œê°’} **${íŒì •íŠ¹ê¸°} íŒì •** ğŸ²`);
    }
}

	
	
    // Character Management
    if (command === '!ì‹œíŠ¸ì‚­ì œ') {
        delete characterData[message.author.id];
        saveData();
        message.reply('âŒ ìºë¦­í„° ì‹œíŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

// ğŸ”¹ ì‹œíŠ¸ í™•ì¸ (ì˜ì—­, ì¥ì„œ, ì•µì»¤ í¬í•¨)
if (command === '!ì‹œíŠ¸í™•ì¸') {
    if (!characterData[message.author.id]) {
        return message.reply('âŒ ë“±ë¡ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    const char = characterData[message.author.id];

    // `ì´ë¦„` í•„ë“œê°€ ì •ìƒì ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ì¶œë ¥
    const ìºë¦­í„°ì´ë¦„ = char.ì´ë¦„ || 'ë¯¸ì„¤ì •';

    // ğŸ“ íŠ¹ê¸° ëª©ë¡ ì¶œë ¥
    const íŠ¹ê¸°ëª©ë¡ì¶œë ¥ = char.íŠ¹ê¸° && char.íŠ¹ê¸°.length > 0 ? char.íŠ¹ê¸°.join(', ') : 'ì—†ìŒ';

    // ğŸ“œ ì¥ì„œ ëª©ë¡ ì¶œë ¥ (ê¸´ê¸‰ ì†Œí™˜ í¬í•¨, ì¥ì„œê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •)
    if (!char.ì¥ì„œ) char.ì¥ì„œ = {}; // ğŸ”¥ ì¥ì„œê°€ undefinedì¼ ê²½ìš° ë¹ˆ ê°ì²´ë¡œ ì´ˆê¸°í™”
	
const ì¥ì„œì¶œë ¥ = Object.keys(char.ì¥ì„œ).length > 0
    ? Object.entries(char.ì¥ì„œ)
        .map(([ì´ë¦„, { íƒ€ì…, íŒì •íŠ¹ê¸°, ë§ˆì†Œì˜ì—­, ë§ˆì†Œì½”ìŠ¤íŠ¸, í˜„ì¬ë§ˆì†Œ }]) => {
            // ğŸ”¹ í•´ë‹¹ ë§ˆì†Œ ì˜ì—­ì˜ ì´ëª¨ì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ ğŸ“– ì´ëª¨ì§€)
            const ì´ëª¨ì§€ = ë§ˆì†Œì˜ì—­ && ì˜ì—­ì´ëª¨ì§€[ë§ˆì†Œì˜ì—­] ? ì˜ì—­ì´ëª¨ì§€[ë§ˆì†Œì˜ì—­] : 'ğŸ“–';

            // ğŸ”¹ ê°œë³„ ì¥ì„œì˜ í˜„ì¬ ë§ˆì†Œê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ 0 ì„¤ì •
            if (í˜„ì¬ë§ˆì†Œ === undefined) í˜„ì¬ë§ˆì†Œ = 0;

            // ğŸ”¹ ë§ˆì†Œ ì •ë³´ ì¶œë ¥ ì¡°ê±´ (ë§ˆì†Œì½”ìŠ¤íŠ¸ê°€ 0ì´ë©´ "ì—†ìŒ" ì²˜ë¦¬)
            const ë§ˆì†Œí‘œì‹œ = ë§ˆì†Œì½”ìŠ¤íŠ¸ && ë§ˆì†Œì½”ìŠ¤íŠ¸ > 0 ? `${í˜„ì¬ë§ˆì†Œ} / ${char.ëŠ¥ë ¥ì¹˜?.ê·¼ì›ë ¥ || ê³„ì œì¶œë ¥}` : 'ì—†ìŒ';

            return `${ì´ëª¨ì§€} **${ì´ë¦„}** | ${íƒ€ì… || "ì—†ìŒ"} | ${íŒì •íŠ¹ê¸°} | ${ë§ˆì†Œí‘œì‹œ}`;
        })
        .join('\n')
    : 'ì—†ìŒ';

  const ê¸°ê´€ì¶œë ¥ = char.ê¸°ê´€ || 'ë¯¸ì„¤ì •';
    const ê³„ì œì¶œë ¥ = char.ê³„ì œ || 3; // ê¸°ë³¸ê°’ 3
    const ìœ„ê³„ì¶œë ¥ = char.ìœ„ê³„ || 'ë¯¸ì„¤ì •';
 

    // ğŸ’  í˜¼ì˜ íŠ¹ê¸° ì¶œë ¥
    const í˜¼ì˜íŠ¹ê¸°ì¶œë ¥ = char.í˜¼ì˜íŠ¹ê¸° ? `ğŸ’  ${char.í˜¼ì˜íŠ¹ê¸°}` : 'ì—†ìŒ';

    // ğŸŒ€ ì›í˜• ì¶œë ¥
    const ì›í˜•ì¶œë ¥ = char.ì›í˜• ? `ğŸŒ€ ${char.ì›í˜•.ì´ë¦„}` : 'ì—†ìŒ';

    // ğŸ”¹ ëŠ¥ë ¥ì¹˜ ì¶œë ¥
    const ëŠ¥ë ¥ì¹˜ì¶œë ¥ = `ê³µê²©ë ¥ ${char.ëŠ¥ë ¥ì¹˜?.ê³µê²©ë ¥ || ê³„ì œì¶œë ¥} | ë°©ì–´ë ¥ ${char.ëŠ¥ë ¥ì¹˜?.ë°©ì–´ë ¥ || ê³„ì œì¶œë ¥} | ê·¼ì›ë ¥ ${char.ëŠ¥ë ¥ì¹˜?.ê·¼ì›ë ¥ || ê³„ì œì¶œë ¥}`;

    const ì˜ì—­ì¶œë ¥ = char.ì˜ì—­ ? `**${char.ì˜ì—­}**` : 'ë¯¸ì„¤ì •';

    // ğŸ”¹ ë§ˆë²•ëª… ì¶œë ¥
    const ë§ˆë²•ëª…ì¶œë ¥ = char.ë§ˆë²•ëª… ? `**${char.ë§ˆë²•ëª…}**` : 'ë¯¸ì„¤ì •';

    // ğŸ­ ì•µì»¤ ì¶œë ¥
    const ì•µì»¤ì¶œë ¥ = char.ì•µì»¤ && Object.keys(char.ì•µì»¤).length > 0
        ? Object.entries(char.ì•µì»¤)
            .map(([ì´ë¦„, { ì†ì„±, ìš´ëª…ì  }]) => `**${ì´ë¦„}** (${ì†ì„±}, ìš´ëª…ì  ${ìš´ëª…ì })`)
            .join('\n')
        : 'ì—†ìŒ';
// ğŸ“œ **ìµœì¢… ì¶œë ¥ (ì¸ìš© ë¸”ë¡ì„ í™œìš©í•œ ì •ë¦¬)**
message.reply(`
ğŸ“– **ìºë¦­í„° ì •ë³´**
> **ì œ ${ê³„ì œì¶œë ¥}ê³„ì œ ${ê¸°ê´€ì¶œë ¥}ì˜ ${ìœ„ê³„ì¶œë ¥}**
> ğŸ”¹ ${ì˜ì—­ì¶œë ¥}ì˜ ë§ˆë²•ì‚¬ **ã€Œ${ë§ˆë²•ëª…ì¶œë ¥}ã€**
> ğŸ”¹ ${ìºë¦­í„°ì´ë¦„}
> ğŸ”¹ ${ëŠ¥ë ¥ì¹˜ì¶œë ¥}

ğŸ”¹ **íŠ¹ê¸° ëª©ë¡**
> ${íŠ¹ê¸°ëª©ë¡ì¶œë ¥}
ğŸ”¹ **í˜¼ì˜ íŠ¹ê¸°**
> ${í˜¼ì˜íŠ¹ê¸°ì¶œë ¥}

ğŸ”¹ **ì¥ì„œ ëª©ë¡**
${ì¥ì„œì¶œë ¥ ? ì¥ì„œì¶œë ¥.split('\n').map(line => `> ${line}`).join('\n') : '> ì—†ìŒ'}

ğŸ”¹ **ì•µì»¤ ëª©ë¡**
${ì•µì»¤ì¶œë ¥ ? ì•µì»¤ì¶œë ¥.split('\n').map(line => `> ${line}`).join('\n') : '> ì—†ìŒ'}
`);


}

const ê¸°ê´€ëª©ë¡ = ["ì›íƒ", "ì²œì• ", "í•™ì›", "ë¬¸í˜¸", "ì—½ê·€", "ì•„ë°©ê¶"];
const ìœ„ê³„ëª©ë¡ = ["ì„œê²½", "ì‚¬ì„œ", "ì„œê³µ", "ë°©ë¬¸ì", "ì´ë‹¨ì", "ì™¸ì „"];

if (command === '!ê¸°ê´€') {
    const ê¸°ê´€ = args[0];
    if (!ê¸°ê´€ëª©ë¡.includes(ê¸°ê´€)) {
        return message.reply(`âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê¸°ê´€ì…ë‹ˆë‹¤. (ì‚¬ìš© ê°€ëŠ¥: ${ê¸°ê´€ëª©ë¡.join(', ')})`);
    }
    if (!characterData[message.author.id]) characterData[message.author.id] = {};
    characterData[message.author.id].ê¸°ê´€ = ê¸°ê´€;
    saveData();
    message.reply(`âœ… ê¸°ê´€ì´ **${ê¸°ê´€}**(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

if (command === '!ê³„ì œ') {
    let ê³„ì œ = parseInt(args[0]);
    if (isNaN(ê³„ì œ) || ê³„ì œ < 1 || ê³„ì œ > 7) {
        return message.reply('âŒ ê³„ì œëŠ” 1ë¶€í„° 7ê¹Œì§€ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    }
    if (!characterData[message.author.id]) characterData[message.author.id] = {};
    characterData[message.author.id].ê³„ì œ = ê³„ì œ;
    characterData[message.author.id].ëŠ¥ë ¥ì¹˜ = { ê³µê²©ë ¥: ê³„ì œ, ë°©ì–´ë ¥: ê³„ì œ, ê·¼ì›ë ¥: ê³„ì œ }; // ê³„ì œì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
    saveData();
    message.reply(`âœ… ê³„ì œê°€ **${ê³„ì œ}**(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

if (command === '!ìœ„ê³„') {
    const ìœ„ê³„ = args[0];
    if (!ìœ„ê³„ëª©ë¡.includes(ìœ„ê³„)) {
        return message.reply(`âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìœ„ê³„ì…ë‹ˆë‹¤. (ì‚¬ìš© ê°€ëŠ¥: ${ìœ„ê³„ëª©ë¡.join(', ')})`);
    }
    if (!characterData[message.author.id]) characterData[message.author.id] = {};
    characterData[message.author.id].ìœ„ê³„ = ìœ„ê³„;
    saveData();
    message.reply(`âœ… ìœ„ê³„ê°€ **${ìœ„ê³„}**(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

	
	// ğŸ”¹ ë§ˆë²•ëª… ì„¤ì •
    if (command === '!ë§ˆë²•ëª…') {
        if (!args || args.length < 1) return message.reply('âŒ ì‚¬ìš©ë²•: `!ë§ˆë²•ëª… "ë§ˆë²• ì´ë¦„"` (í°ë”°ì˜´í‘œ í•„ìˆ˜)');

        let ë§ˆë²•ëª… = args.join(' '); 
        ë§ˆë²•ëª… = ë§ˆë²•ëª….replace(/(^"|"$)/g, ''); // ì•ë’¤ ë”°ì˜´í‘œ ì œê±°

        if (!characterData[message.author.id]) {
            return message.reply('âŒ ë¨¼ì € `!ì‹œíŠ¸ì…ë ¥`ìœ¼ë¡œ ìºë¦­í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
        }

        characterData[message.author.id].ë§ˆë²•ëª… = ë§ˆë²•ëª…;
        saveData();

        message.reply(`âœ… ë§ˆë²•ëª…ì´ **${ë§ˆë²•ëª…}**(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
		
	}

    // ì„œë²„ IDê°€ ì¡´ì¬í•˜ë©´ ì„œë²„ë³„ë¡œ, DMì´ë©´ 'DM'ìœ¼ë¡œ êµ¬ë¶„
    const guildId = message.guild ? message.guild.id : "DM";

    // ğŸ”¹ ìºë¦­í„° ì§€ì • (ì„œë²„ë³„ë¡œ ë‹¤ë¥¸ ìºë¦­í„° ì§€ì • ê°€ëŠ¥)
    if (command === '!ì§€ì •') {
        if (!characterData[message.author.id]) return message.reply('âŒ ë¨¼ì € ìºë¦­í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.');

        if (!characterData[message.author.id].í™œì„±) {
            characterData[message.author.id].í™œì„± = {}; // ì„œë²„ë³„ ì§€ì • ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì¡° ë³€ê²½
        }
        characterData[message.author.id].í™œì„±[guildId] = true;
        saveData();

        message.reply(`âœ… ìºë¦­í„° **${characterData[message.author.id].ì´ë¦„}**ì´(ê°€) **${message.guild ? 'ì´ ì„œë²„ì—ì„œ' : 'DMì—ì„œ'}** í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ğŸ”¹ ìºë¦­í„° ì§€ì • í•´ì œ (ì„œë²„ë³„ë¡œ ê´€ë¦¬)
    if (command === '!ì§€ì •í•´ì œ') {
        if (!characterData[message.author.id] || !characterData[message.author.id].í™œì„± || !characterData[message.author.id].í™œì„±[guildId]) {
            return message.reply('âŒ í™œì„±í™”ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
        delete characterData[message.author.id].í™œì„±[guildId];
        saveData();
        message.reply(`âŒ **${message.guild ? 'ì´ ì„œë²„ì—ì„œ' : 'DMì—ì„œ'}** ìºë¦­í„° í™œì„±í™”ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
	  // ğŸ”¹ ëœë¤ í”Œë¡¯ ìƒì„±
    if (command === '!ëœë¤í”Œë¡¯') {
        let count = parseInt(args[0]);
        if (isNaN(count) || count < 1 || count > 6) return message.reply('âŒ í”Œë¡¯ ê°œìˆ˜ëŠ” 1~6 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        
        const numbers = Array.from({ length: count }, () => Math.floor(Math.random() * 6) + 1);
        plotData[message.author.id] = numbers;
        message.reply(`âœ… ëœë¤ í”Œë¡¯ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ${numbers.join(', ')}`);
    }

    // ğŸ”¹ í”Œë¡¯ ê³µê°œ (í”Œë¡¯ ì°¸ì—¬ì ëª©ë¡ ì¶œë ¥)
    if (command === '!í”Œë¡¯ê³µê°œ') {
        if (Object.keys(plotData).length === 0) {
            return message.reply('âŒ í˜„ì¬ ì €ì¥ëœ í”Œë¡¯ì´ ì—†ìŠµë‹ˆë‹¤.');
        }

        let result = `ğŸ² **í”Œë¡¯ ê³µê°œ**:\n`;
        for (const [userId, numbers] of Object.entries(plotData)) {
            result += `<@${userId}>: ${numbers.join(', ')}\n`;
        }

        // í”Œë¡¯ ë°ì´í„° ì´ˆê¸°í™”
        plotData = {};
        message.channel.send(result);
    }

// ê¸°ì¡´ args ë³€ìˆ˜ë¥¼ ìœ ì§€í•˜ë©´ì„œ ìƒˆ ë³€ìˆ˜ë¡œ ë”°ì˜´í‘œ ì²˜ë¦¬ëœ ë°ì´í„° ë¶„ë¦¬
    let parsedArgs = message.content.match(/"([^"]+)"|\S+/g);
    if (!parsedArgs) return;

    let parsedArgsCommand = parsedArgs.shift(); // ì²« ë²ˆì§¸ ë‹¨ì–´ê°€ ëª…ë ¹ì–´


if (command === '!ì¥ì„œì¶”ê°€') {
    const commandPattern = /^!ì¥ì„œì¶”ê°€\s+"([^"]+)"\s+(\S+)\s+(\S+)\s+(\S+)\s*(\d*)\s+(.+)$/s;
    const match = message.content.match(commandPattern);

    if (!match) {
        return message.reply(
            'âŒ ì‚¬ìš©ë²•: `!ì¥ì„œì¶”ê°€ "ì¥ì„œëª…" [íƒ€ì…] [íŒì •íŠ¹ê¸°] [ë§ˆì†Œì˜ì—­] [ì½”ìŠ¤íŠ¸] [ì„¤ëª…]`\n' +
            'ì˜ˆ: `!ì¥ì„œì¶”ê°€ "ë§ˆê²€ ì†Œí™˜" ê³µê²© ì„ ìœ¨ ë…¸ë˜ 2 ê°•ë ¥í•œ ê²€ì„ ì†Œí™˜í•œë‹¤.`'
        );
    }

    let ì¥ì„œëª… = match[1].trim();
    let íƒ€ì… = match[2].trim();
    let íŒì •íŠ¹ê¸° = match[3].trim();
    let ë§ˆì†Œì˜ì—­ = match[4].trim();
    let ë§ˆì†Œì½”ìŠ¤íŠ¸ = match[5].trim();
    const ë‚´ìš© = match[6].trim();

    // ğŸ”¹ "ì—†ìŒ"ì„ ì…ë ¥í•œ ê²½ìš° ì²˜ë¦¬
    if (íƒ€ì… === "ì—†ìŒ") íƒ€ì… = null;
    if (ë§ˆì†Œì˜ì—­ === "ì—†ìŒ") {
        ë§ˆì†Œì˜ì—­ = null;
        ë§ˆì†Œì½”ìŠ¤íŠ¸ = 0;
    } else if (!Object.keys(ì˜ì—­ì´ëª¨ì§€).includes(ë§ˆì†Œì˜ì—­)) {
        return message.reply(`âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ë§ˆì†Œ ì˜ì—­ì…ë‹ˆë‹¤: **${ë§ˆì†Œì˜ì—­}**\n(ì‚¬ìš© ê°€ëŠ¥: ë³„, ì§ìŠ¹, í˜, ë…¸ë˜, ê¿ˆ, ì–´ë‘ , ì—†ìŒ)`);
    }

    // ğŸ”¹ ë§ˆì†Œì½”ìŠ¤íŠ¸ê°€ ë¹„ì–´ ìˆê±°ë‚˜ "ì—†ìŒ"ì¼ ê²½ìš° 0ìœ¼ë¡œ ì„¤ì •
    ë§ˆì†Œì½”ìŠ¤íŠ¸ = ë§ˆì†Œì½”ìŠ¤íŠ¸ === "" || isNaN(ë§ˆì†Œì½”ìŠ¤íŠ¸) ? 0 : parseInt(ë§ˆì†Œì½”ìŠ¤íŠ¸, 10);

    // ğŸ”¹ ìºë¦­í„° ë°ì´í„° ì´ˆê¸°í™”
    if (!characterData[message.author.id]) {
        characterData[message.author.id] = { ì¥ì„œ: {} };
    }
    if (!characterData[message.author.id].ì¥ì„œ) {
        characterData[message.author.id].ì¥ì„œ = {};
    }

    // ğŸ”¹ ì¥ì„œ ì¶”ê°€
    characterData[message.author.id].ì¥ì„œ[ì¥ì„œëª…] = { íƒ€ì…, íŒì •íŠ¹ê¸°, ë§ˆì†Œì˜ì—­, ë§ˆì†Œì½”ìŠ¤íŠ¸, ë‚´ìš© };
    saveData();

    message.reply(
        `ğŸ“–  ì¥ì„œ **"${ì¥ì„œëª…}"**(ì´)ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\n` +
        `ğŸ”¹ **íƒ€ì…**: ${íƒ€ì… ? íƒ€ì… : "ì—†ìŒ"}\n` +
        `ğŸ”¹ **íŒì •íŠ¹ê¸°**: ${íŒì •íŠ¹ê¸°}\n` +
        `ğŸ”¹ **ì½”ìŠ¤íŠ¸**: ${ë§ˆì†Œì˜ì—­ ? `${ë§ˆì†Œì˜ì—­} ${ë§ˆì†Œì½”ìŠ¤íŠ¸}` : "ì—†ìŒ"}\n` +
        `**ì„¤ëª…**: ${ë‚´ìš©}`
    );
}




// ğŸ”¹ ê°œë³„ ì¥ì„œì— ë§ˆì†Œ ì¶©ì „ ë° ê°ì†Œ (`!ì¥ì„œëª…+1`, `!ì¥ì„œëª…-1`)
if (/^!.+\s?[\+\-]1$/.test(command)) {  
    const increase = command.includes("+1") ? 1 : -1;
    
    // ğŸ” ëª…ë ¹ì–´ì—ì„œ ì¥ì„œëª… ì¶”ì¶œ (`+1` ë˜ëŠ” `-1` ë¶€ë¶„ ì œê±°)
    let ì…ë ¥ì¥ì„œëª… = command.replace(/^!/, '').replace(/\s?[\+\-]1$/, '').trim();

    const char = characterData[message.author.id];
    if (!char || !char.ì¥ì„œ) {
        return message.reply('âŒ ë“±ë¡ëœ ì¥ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    // ğŸ” ì…ë ¥ê°’ê³¼ ì €ì¥ëœ ì¥ì„œëª… ë¹„êµ (ê³µë°± ì œê±° í›„ ë§¤ì¹­)
    const ì¥ì„œí‚¤ = Object.keys(char.ì¥ì„œ).find(ì¥ì„œ => ì¥ì„œ.replace(/\s+/g, '') === ì…ë ¥ì¥ì„œëª….replace(/\s+/g, ''));
    if (!ì¥ì„œí‚¤) {
        return message.reply(`âŒ í•´ë‹¹ ì¥ì„œë¥¼ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.  
ğŸ“– **ë³´ìœ í•œ ì¥ì„œ**: ${Object.keys(char.ì¥ì„œ).join(', ') || 'ì—†ìŒ'}`);
    }

    const ì¥ì„œ = char.ì¥ì„œ[ì¥ì„œí‚¤];

    // âœ… ê°œë³„ ì¥ì„œ ë§ˆì†Œ ì¶©ì „ëŸ‰ ê´€ë¦¬
    if (ì¥ì„œ.í˜„ì¬ë§ˆì†Œ === undefined) ì¥ì„œ.í˜„ì¬ë§ˆì†Œ = 0;

    // ğŸ”¹ ë§ˆì†Œ ì¶©ì „ (ìµœëŒ€ ìºë¦­í„° ê·¼ì›ë ¥ë§Œí¼)
    if (increase === 1) {
        if (ì¥ì„œ.í˜„ì¬ë§ˆì†Œ >= char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥) {
            return message.reply(`âŒ **${ì¥ì„œ.ë§ˆì†Œì˜ì—­} ë§ˆì†Œ**ëŠ” ìµœëŒ€ ê·¼ì›ë ¥(${char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥})ì„ ì´ˆê³¼í•˜ì—¬ ì¶©ì „í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
        }
        ì¥ì„œ.í˜„ì¬ë§ˆì†Œ += 1;
        saveData();
        return message.reply(`**${ì¥ì„œí‚¤}** â†’ **${ì¥ì„œ.ë§ˆì†Œì˜ì—­} ë§ˆì†Œ +1** (í˜„ì¬: ${ì¥ì„œ.í˜„ì¬ë§ˆì†Œ} / ${char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥})`);
    }

    // ğŸ”» ë§ˆì†Œ ê°ì†Œ (ìµœì†Œ 0 ì´ìƒ)
    if (increase === -1) {
        if (ì¥ì„œ.í˜„ì¬ë§ˆì†Œ <= 0) {
            return message.reply(`âŒ **${ì¥ì„œ.ë§ˆì†Œì˜ì—­} ë§ˆì†Œ**ê°€ ë¶€ì¡±í•˜ì—¬ ê°ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        }
        ì¥ì„œ.í˜„ì¬ë§ˆì†Œ -= 1;
        saveData();
        return message.reply(`**${ì¥ì„œí‚¤}** â†’ **${ì¥ì„œ.ë§ˆì†Œì˜ì—­} ë§ˆì†Œ -1** (í˜„ì¬: ${ì¥ì„œ.í˜„ì¬ë§ˆì†Œ} / ${char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥})`);
    }
}




// ğŸ”¹ ì¥ì„œ íŒì • (ë„ì–´ì“°ê¸° í¬í•¨)
if (command === '!ì¥ì„œ') {
    let ì…ë ¥ì¥ì„œëª… = args.join(' ').trim(); // ì‚¬ìš©ì ì…ë ¥ê°’ì—ì„œ ê³µë°±ì„ í¬í•¨í•œ ì „ì²´ ì¥ì„œëª…
    const char = characterData[message.author.id];

    if (!char || !char.ì¥ì„œ) {
        return message.reply('âŒ ë“±ë¡ëœ ì¥ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    // ğŸ” ì…ë ¥ê°’ê³¼ ì €ì¥ëœ ì¥ì„œëª… ë¹„êµ (ê³µë°± ì œê±° í›„ ë§¤ì¹­)
    const ì¥ì„œí‚¤ = Object.keys(char.ì¥ì„œ).find(ì¥ì„œ => ì¥ì„œ.replace(/\s+/g, '') === ì…ë ¥ì¥ì„œëª….replace(/\s+/g, ''));

    if (!ì¥ì„œí‚¤) {
        return message.reply(`âŒ í•´ë‹¹ ì¥ì„œë¥¼ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.  
ğŸ“– **ë³´ìœ í•œ ì¥ì„œ**: ${Object.keys(char.ì¥ì„œ).join(', ') || 'ì—†ìŒ'}`);
    }

    let ì¥ì„œ = char.ì¥ì„œ[ì¥ì„œí‚¤];
    let { íƒ€ì…, íŒì •íŠ¹ê¸°, ë§ˆì†Œì˜ì—­, ë§ˆì†Œì½”ìŠ¤íŠ¸, ë‚´ìš© } = ì¥ì„œ;

    // ğŸŒ€ `ê°€ë³€` íŠ¹ê¸° ì²˜ë¦¬ (ëœë¤ íŠ¹ê¸° ì„ íƒ)
    if (íŒì •íŠ¹ê¸° === "ê°€ë³€") {
        const ëœë¤ë¶„ì•¼ = Math.floor(Math.random() * 6);
        const ëœë¤íŠ¹ê¸° = Math.floor(Math.random() * 11);
        íŒì •íŠ¹ê¸° = íŠ¹ê¸°ëª©ë¡[ëœë¤íŠ¹ê¸°][ëœë¤ë¶„ì•¼];
        ì¥ì„œ.íŒì •íŠ¹ê¸° = íŒì •íŠ¹ê¸°;
        saveData();
    }

    // ğŸŒ€ `ì˜ì—­` íŠ¹ê¸° ì²˜ë¦¬ (í•´ë‹¹ ì˜ì—­ ë‚´ì—ì„œ ëœë¤ ì„ íƒ)
    if (ì˜ì—­ëª©ë¡.includes(íŒì •íŠ¹ê¸°)) {
        const ì˜ì—­ì¸ë±ìŠ¤ = ì˜ì—­ëª©ë¡.indexOf(íŒì •íŠ¹ê¸°);
        const ëœë¤íŠ¹ê¸° = Math.floor(Math.random() * 11);
        íŒì •íŠ¹ê¸° = íŠ¹ê¸°ëª©ë¡[ëœë¤íŠ¹ê¸°][ì˜ì—­ì¸ë±ìŠ¤];
        ì¥ì„œ.íŒì •íŠ¹ê¸° = íŒì •íŠ¹ê¸°;
        saveData();
    }

    // ğŸ”¹ ì¥ì„œ ì‚¬ìš© ì‹œ ê°œë³„ ë§ˆì†Œ í™•ì¸
    if (ì¥ì„œ.í˜„ì¬ë§ˆì†Œ === undefined) ì¥ì„œ.í˜„ì¬ë§ˆì†Œ = 0;
    let í˜„ì¬ë§ˆì†Œ = ì¥ì„œ.í˜„ì¬ë§ˆì†Œ;

    // ğŸ”¹ **ë§ˆì†Œê°€ ë¶€ì¡±í•˜ë©´ íƒ€ì…ê³¼ ê´€ê³„ì—†ì´ ì‚¬ìš© ë¶ˆê°€**
    if (í˜„ì¬ë§ˆì†Œ < ë§ˆì†Œì½”ìŠ¤íŠ¸) {
        return message.reply(`âŒ ë§ˆì†Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!  
**í•„ìš” ë§ˆì†Œ**: ${ë§ˆì†Œì˜ì—­} ${ë§ˆì†Œì½”ìŠ¤íŠ¸}ê°œ  
**í˜„ì¬ ë§ˆì†Œ**: ${í˜„ì¬ë§ˆì†Œ}ê°œ`);
    }

    // ğŸ”» **ë§ˆì†Œ ì°¨ê° (ì¥ë¹„ëŠ” ì°¨ê° ì—†ìŒ, ê·¸ëŸ¬ë‚˜ í•„ìš” ë§ˆì†ŒëŠ” ìœ ì§€)**
    if (íƒ€ì… !== "ì¥ë¹„") {
        ì¥ì„œ.í˜„ì¬ë§ˆì†Œ -= ë§ˆì†Œì½”ìŠ¤íŠ¸;
        í˜„ì¬ë§ˆì†Œ = ì¥ì„œ.í˜„ì¬ë§ˆì†Œ;
        saveData();
    }

    // ğŸ”¹ **íŒì •íŠ¹ê¸°ê°€ "ì—†ìŒ"ì´ë©´ ë‚´ìš©ë§Œ ì¶œë ¥**
    if (íŒì •íŠ¹ê¸° === "ì—†ìŒ") {
        return message.reply(
            `ğŸ“– **${ì¥ì„œí‚¤}**  
**íƒ€ì…**: ${íƒ€ì… || "ì—†ìŒ"}  
**ì„¤ëª…**: ${ë‚´ìš©}  
ğŸ”¹ **í˜„ì¬ ë§ˆì†Œ**: ${í˜„ì¬ë§ˆì†Œ} / ${char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥}`
        );
    }

    // ğŸ”¹ ëª©í‘œê°’ ê³„ì‚° (ê¸°ë³¸ê°’: 5)
    let ëª©í‘œê°’ = 5;
    const ì˜ì—­ = char.ì˜ì—­ ? ì˜ì—­ëª©ë¡.indexOf(char.ì˜ì—­) : null;
    let íŠ¹ê¸°ìœ„ì¹˜ = null;

    // ğŸ” íŒì •íŠ¹ê¸°ì˜ ìœ„ì¹˜ ì°¾ê¸°
    íŠ¹ê¸°ëª©ë¡.some((row, y) => row.some((íŠ¹ê¸°, x) => {
        if (íŠ¹ê¸° === íŒì •íŠ¹ê¸°) {
            íŠ¹ê¸°ìœ„ì¹˜ = { x, y };
            return true;
        }
    }));

    if (!íŠ¹ê¸°ìœ„ì¹˜) return message.reply('âŒ ìœ íš¨í•˜ì§€ ì•Šì€ íŠ¹ê¸°ì…ë‹ˆë‹¤.');

    // ğŸ”¹ ê°€ì¥ ê°€ê¹Œìš´ ì„¤ì • íŠ¹ê¸°ì™€ì˜ ê±°ë¦¬ ê³„ì‚°
    let ìµœì†Œê±°ë¦¬ = Infinity;
    char.íŠ¹ê¸°.forEach(ì„¤ì •íŠ¹ê¸° => {
        íŠ¹ê¸°ëª©ë¡.some((row, y) => row.some((íŠ¹ê¸°, x) => {
            if (íŠ¹ê¸° === ì„¤ì •íŠ¹ê¸°) {
                let ê±°ë¦¬X = Math.abs(íŠ¹ê¸°ìœ„ì¹˜.x - x);
                let ê±°ë¦¬Y = Math.abs(íŠ¹ê¸°ìœ„ì¹˜.y - y);
                let ê°€ë¡œì´ë™ê°’ = (ì˜ì—­ !== null && (x === ì˜ì—­ || íŠ¹ê¸°ìœ„ì¹˜.x === ì˜ì—­)) ? 1 : 2;
                let í˜„ì¬ê±°ë¦¬ = ê±°ë¦¬Y + (ê±°ë¦¬X * ê°€ë¡œì´ë™ê°’);
                ìµœì†Œê±°ë¦¬ = Math.min(ìµœì†Œê±°ë¦¬, í˜„ì¬ê±°ë¦¬);
                return true;
            }
        }));
    });

    ëª©í‘œê°’ += ìµœì†Œê±°ë¦¬;
    // ğŸ“œ ê²°ê³¼ ë©”ì‹œì§€ (ë§ˆì†Œë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ì¶œë ¥í•˜ì§€ ì•ŠìŒ)
    message.reply(
`ğŸ”¹ ${ì¥ì„œí‚¤}
**íƒ€ì…**: ${ì¥ì„œ.íƒ€ì… || "ì—†ìŒ"}   **íŒì •íŠ¹ê¸°**: ${íŒì •íŠ¹ê¸°}  
**ì„¤ëª…**: ${ë‚´ìš©}
í˜„ì¬  **${í˜„ì¬ë§ˆì†Œ} / ${char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥}**ê°œì˜ ë§ˆì†Œê°€ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
 
 message.reply(`2D6>=${ëª©í‘œê°’} **${íŒì •íŠ¹ê¸°} íŒì •**`);
 }



    // ğŸ”¹ ì¥ì„œ ì‚­ì œ (ë„ì–´ì“°ê¸° í¬í•¨)
    if (command === '!ì¥ì„œì‚­ì œ') {
        const ì¥ì„œëª… = args.join(' '); // ë„ì–´ì“°ê¸° í¬í•¨
        if (!characterData[message.author.id] || !characterData[message.author.id].ì¥ì„œ[ì¥ì„œëª…]) {
            return message.reply('âŒ í•´ë‹¹ ì¥ì„œë¥¼ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }

        delete characterData[message.author.id].ì¥ì„œ[ì¥ì„œëª…];
        saveData();
        message.reply(`âŒ ì¥ì„œ **"${ì¥ì„œëª…}"**(ì´)ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
	
/// ğŸ“œ ì¥ì„œ ëª©ë¡ ì¶œë ¥ (ê° ì¥ì„œë³„ ë§ˆì†Œ ì¶©ì „ëŸ‰ í‘œì‹œ)
if (command === '!ì¥ì„œëª©ë¡') {
    const char = characterData[message.author.id];
    if (!char || !char.ì¥ì„œ || Object.keys(char.ì¥ì„œ).length === 0) {
        return message.reply('ğŸ“– ë³´ìœ í•œ ì¥ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    // ğŸ“œ ì¥ì„œ ëª©ë¡ ì •ë¦¬
 const ì¥ì„œë¦¬ìŠ¤íŠ¸ = Object.entries(char.ì¥ì„œ)
    .map(([ì´ë¦„, { íƒ€ì…, íŒì •íŠ¹ê¸°, ë§ˆì†Œì˜ì—­, ë§ˆì†Œì½”ìŠ¤íŠ¸, í˜„ì¬ë§ˆì†Œ = 0 }]) => {
            // ğŸ”¹ íŒì •íŠ¹ê¸°ê°€ ì†í•œ ì˜ì—­ ì°¾ê¸°
            let íŠ¹ê¸°ì˜ì—­ì´ë¦„ = 'ì—†ìŒ';
            for (let i = 0; i < ì˜ì—­ëª©ë¡.length; i++) {
                if (íŠ¹ê¸°ëª©ë¡.some(row => row[i] === íŒì •íŠ¹ê¸°)) {
                    íŠ¹ê¸°ì˜ì—­ì´ë¦„ = ì˜ì—­ëª©ë¡[i];
                    break;
                }
            }

            // ë§ˆì†Œì˜ì—­ ë˜ëŠ” ë§ˆì†Œì½”ìŠ¤íŠ¸ê°€ ì—†ëŠ” ê²½ìš° "ì—†ìŒ" ì²˜ë¦¬
            const ë§ˆì†Œí‘œì‹œ = ë§ˆì†Œì˜ì—­ && ë§ˆì†Œì½”ìŠ¤íŠ¸ ? `${ë§ˆì†Œì˜ì—­} ${ë§ˆì†Œì½”ìŠ¤íŠ¸}` : 'ì—†ìŒ';

            return `**${ì´ë¦„}** | ${íƒ€ì… || "ì—†ìŒ"} | **${íŒì •íŠ¹ê¸°}** | **${ë§ˆì†Œí‘œì‹œ}** | **${í˜„ì¬ë§ˆì†Œ} / ${char.ëŠ¥ë ¥ì¹˜.ê·¼ì›ë ¥}**`;
        })
        .join('\n');

    message.reply(`ğŸ“– **ì¥ì„œ ëª©ë¡**\n${ì¥ì„œë¦¬ìŠ¤íŠ¸}`);
}

	// ğŸ”¹ ì¥ì„œ ë¦¬ì…‹ (ëª¨ë“  ì¥ì„œ ì‚­ì œ, "ê¸´ê¸‰ ì†Œí™˜" ìœ ì§€)
if (command === '!ì¥ì„œë¦¬ì…‹') {
    const char = characterData[message.author.id];

    if (!char || !char.ì¥ì„œ || Object.keys(char.ì¥ì„œ).length === 0) {
        return message.reply('âŒ ì‚­ì œí•  ì¥ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
    }

    // ğŸ”¹ "ê¸´ê¸‰ ì†Œí™˜"ë§Œ ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ ì¥ì„œ ì‚­ì œ
    char.ì¥ì„œ = {
        "ê¸´ê¸‰ ì†Œí™˜": {
            íŒì •íŠ¹ê¸°: "ê°€ë³€",
            ë‚´ìš©: "1D6ì„ êµ´ë ¤ ë¶„ì•¼ë¥¼ ë¬´ì‘ìœ„ë¡œ ì •í•˜ê³ , ê·¸ ë’¤ì— 2D6ì„ êµ´ë ¤ ë¬´ì‘ìœ„ë¡œ íŠ¹ê¸° í•˜ë‚˜ë¥¼ ì„ íƒí•œë‹¤. ê·¸ê²ƒì´ ì§€ì •íŠ¹ê¸°ê°€ ëœë‹¤. í•´ë‹¹ íŠ¹ê¸°ë¡œ íŒì •ì— ì„±ê³µí•˜ë©´ ê·¸ íŠ¹ê¸°ì— ëŒ€ì‘í•˜ëŠ” ì •ë ¹ 1ê°œì²´ë¥¼ ì†Œí™˜í•  ìˆ˜ ìˆë‹¤."
        }
    };

    saveData();
    message.reply('ğŸš¨ ëª¨ë“  ì¥ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. `"ê¸´ê¸‰ ì†Œí™˜"`ì€ ìœ ì§€ë©ë‹ˆë‹¤.');
}


// ğŸ”¹ ì•µì»¤ ì¶”ê°€ ëª…ë ¹ì–´ (ìš´ëª…ì  ì„¤ì • ê°€ëŠ¥)
if (command === '!ì•µì»¤ì¶”ê°€') {
    if (args.length < 2) {
        return message.reply('âŒ ì‚¬ìš©ë²•: `!ì•µì»¤ì¶”ê°€ [ì´ë¦„] [ì†ì„±] (ìš´ëª…ì )`');
    }

    const ì•µì»¤ì´ë¦„ = args[0];
    const ì†ì„± = args[1];
    let ìš´ëª…ì  = args[2] ? parseInt(args[2]) : 1; // ê¸°ë³¸ê°’ 1, ì…ë ¥ê°’ì´ ìˆìœ¼ë©´ ë³€í™˜

    const ì†ì„±ëª©ë¡ = ["í¥ë¯¸", "í˜ˆì—°", "ì§€ë°°", "ìˆ™ì ", "ì—°ì• ", "ì¡´ê²½"];
    if (!ì†ì„±ëª©ë¡.includes(ì†ì„±)) {
        return message.reply('âŒ ìœ íš¨í•œ ì†ì„±ì´ ì•„ë‹™ë‹ˆë‹¤. (ê°€ëŠ¥í•œ ê°’: í¥ë¯¸, í˜ˆì—°, ì§€ë°°, ìˆ™ì , ì—°ì• , ì¡´ê²½)');
    }

    if (isNaN(ìš´ëª…ì ) || ìš´ëª…ì  < 1 || ìš´ëª…ì  > 5) {
        return message.reply('âŒ ìš´ëª…ì ì€ 1~5 ì‚¬ì´ì˜ ìˆ«ìë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.');
    }

    // ğŸ”¹ ìºë¦­í„° ë°ì´í„° í™•ì¸
    const char = characterData[message.author.id];
    if (!char) {
        return message.reply('âŒ ë¨¼ì € `!ì‹œíŠ¸ì…ë ¥ [ì´ë¦„]` ëª…ë ¹ì–´ë¡œ ìºë¦­í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
    }

    // ğŸ”¹ ì•µì»¤ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
    if (!char.ì•µì»¤) {
        char.ì•µì»¤ = {};
    }

    // ğŸ”¹ ì•µì»¤ ì¶”ê°€
    char.ì•µì»¤[ì•µì»¤ì´ë¦„] = { ì†ì„±, ìš´ëª…ì  };
    saveData();

    return message.reply(`âœ… ì•µì»¤ **"${ì•µì»¤ì´ë¦„}"**(ì´)ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.  
ğŸ”¹ **ì†ì„±**: ${ì†ì„±}  
ğŸ”¹ **ìš´ëª…ì **: ${ìš´ëª…ì }`);
}

    // ğŸ”¹ ì•µì»¤ ì‚­ì œ
    if (command === '!ì•µì»¤ì‚­ì œ') {
        const ì•µì»¤ì´ë¦„ = args.join(' ');
        const char = characterData[message.author.id];

        if (!char || !char.ì•µì»¤[ì•µì»¤ì´ë¦„]) {
            return message.reply('âŒ í•´ë‹¹ ì•µì»¤ë¥¼ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }

        delete char.ì•µì»¤[ì•µì»¤ì´ë¦„];
        saveData();
        message.reply(`âŒ ì•µì»¤ **"${ì•µì»¤ì´ë¦„}"**(ì´)ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
	
// ğŸ”¹ ê³µê²©ê³„ì•½ / ë°©ì–´ê³„ì•½ ì‹¤í–‰ (ìš´ëª…ì  +1 ì¦ê°€ í›„ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°)
if (command === '!ê³µê²©ê³„ì•½' || command === '!ë°©ì–´ê³„ì•½') {
    const ì•µì»¤ì´ë¦„ = args.join(' ');
    const char = characterData[message.author.id];

    if (!char || !char.ì•µì»¤ || !char.ì•µì»¤[ì•µì»¤ì´ë¦„]) {
        return message.reply('âŒ í•´ë‹¹ ì•µì»¤ë¥¼ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }

    if (char.ì•µì»¤[ì•µì»¤ì´ë¦„].ìš´ëª…ì  < 5) {
        char.ì•µì»¤[ì•µì»¤ì´ë¦„].ìš´ëª…ì  += 1;
        const ìƒˆë¡œìš´ìš´ëª…ì  = char.ì•µì»¤[ì•µì»¤ì´ë¦„].ìš´ëª…ì ;
        saveData();

        // âœ… ê³„ì•½ ì‹¤í–‰ ë©”ì‹œì§€
        message.reply(` ${command === '!ê³µê²©ê³„ì•½' ? 'ê³µê²©ê³„ì•½' : 'ë°©ì–´ê³„ì•½'}ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.  
ğŸ”¹ ì•µì»¤ **"${ì•µì»¤ì´ë¦„}"** â†’ ìš´ëª…ì  **${ìƒˆë¡œìš´ìš´ëª…ì }**`);

        // ğŸ² ìë™ìœ¼ë¡œ ë‹¤ì´ìŠ¤ êµ´ë¦¬ê¸° (ë””ìŠ¤ì½”ë“œ ì£¼ì‚¬ìœ„ ë´‡ ë°˜ì‘)
        message.channel.send(`${ìƒˆë¡œìš´ìš´ëª…ì }B6`);
    } else {
        message.reply(`âš ï¸ ì•µì»¤ **"${ì•µì»¤ì´ë¦„}"**ì˜ ìš´ëª…ì ì´ ì´ë¯¸ ìµœëŒ€(5)ì…ë‹ˆë‹¤.`);
    }
}

	
	
	    // ğŸ”¹ ëŠ¥ë ¥ì¹˜ ì¡°ì • (ê³µê²©ë ¥/ë°©ì–´ë ¥/ê·¼ì›ë ¥)
    if (command.startsWith('!ê³µê²©ë ¥') || command.startsWith('!ë°©ì–´ë ¥') || command.startsWith('!ê·¼ì›ë ¥')) {
        initializeCharacter(message.author.id); // ìºë¦­í„° ë°ì´í„° ì´ˆê¸°í™”

        const statType = command.replace('!', '').replace('+1', '').replace('-1', '');
        const change = command.includes('+1') ? 1 : (command.includes('-1') ? -1 : 0);

        if (change === 0) return message.reply('âŒ ì‚¬ìš©ë²•: `!ê³µê²©ë ¥+1`, `!ë°©ì–´ë ¥-1` ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.');

        if (!characterData[message.author.id].ëŠ¥ë ¥ì¹˜) {
            characterData[message.author.id].ëŠ¥ë ¥ì¹˜ = { ê³µê²©ë ¥: 3, ë°©ì–´ë ¥: 3, ê·¼ì›ë ¥: 3 }; // ê¸°ë³¸ê°’ ì„¤ì •
        }

        // ëŠ¥ë ¥ì¹˜ ì¡°ì • (ìµœì†Œ 1, ìµœëŒ€ 7)
        characterData[message.author.id].ëŠ¥ë ¥ì¹˜[statType] = Math.max(1, Math.min(7, characterData[message.author.id].ëŠ¥ë ¥ì¹˜[statType] + change));
        saveData();

        message.reply(`âœ… **${statType}**ì´(ê°€) **${characterData[message.author.id].ëŠ¥ë ¥ì¹˜[statType]}**(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
	
	// ğŸ”¹ ì›í˜• ì„¤ì • (ì´ë¦„ í˜•ì‹ ê°œì„ )
    if (command === '!ì›í˜•ì†Œí™˜') {
        if (args.length < 2) return message.reply('âŒ ì‚¬ìš©ë²•: `!ì›í˜•ì†Œí™˜ [ì›í˜•ì´ë¦„] [íŠ¹ê¸°]`');

        const ì›í˜•ì´ë¦„ = args[0];
        const íŠ¹ê¸° = args[1];

        const ì›í˜•ëª©ë¡ = ["ë§ˆê²€", "ì²˜ë…€", "ê¸°ì‚¬", "ì•…ëª½", "ì™•êµ­", "ì „ì°¨", "ì •ë ¹", "êµ°ë‹¨", "ë§ˆì‹ ", "ë§ˆì™•", "ë‚˜ë½ë¬¸"];
        if (!ì›í˜•ëª©ë¡.includes(ì›í˜•ì´ë¦„)) {
            return message.reply('âŒ ìœ íš¨í•œ ì›í˜•ì´ ì•„ë‹™ë‹ˆë‹¤. (ê°€ëŠ¥í•œ ê°’: ë§ˆê²€, ì²˜ë…€, ê¸°ì‚¬, ì•…ëª½, ì™•êµ­, ì „ì°¨, ì •ë ¹, êµ°ë‹¨, ë§ˆì‹ , ë§ˆì™•, ë‚˜ë½ë¬¸)');
        }

        // ì›í˜• ì¶”ê°€ (íŠ¹ê¸° + ì›í˜•ì´ë¦„ í˜•ì‹ìœ¼ë¡œ ì €ì¥)
        characterData[message.author.id].ì›í˜• = { ì´ë¦„: `${íŠ¹ê¸°}ì˜ ${ì›í˜•ì´ë¦„}` };
        saveData();

        message.reply(`âœ… ì›í˜• **"${íŠ¹ê¸°}ì˜ ${ì›í˜•ì´ë¦„}"**(ì´)ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ğŸ”¹ ì›í˜• ì‚­ì œ
    if (command === '!ì›í˜•ì‚­ì œ') {
        if (!characterData[message.author.id] || !characterData[message.author.id].ì›í˜•) {
            return message.reply('âŒ ì„¤ì •ëœ ì›í˜•ì´ ì—†ìŠµë‹ˆë‹¤.');
        }

        delete characterData[message.author.id].ì›í˜•;
        saveData();
        message.reply('âŒ ì›í˜•ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

	
if (message.content === '!ë„ì›€') {
    await message.reply(
        `ğŸ“œ **MGLGbot ëª…ë ¹ì–´ ëª©ë¡ (1/2)**  
\`\`\`yaml
ğŸ› ï¸ ê¸°ë³¸ ëª…ë ¹ì–´
\`\`\`
**\`!ë„ì›€\`** - ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.  
**\`!ì‹œíŠ¸í™•ì¸\`** - í˜„ì¬ ì„¤ì •ëœ ìºë¦­í„° ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.  

\`\`\`yaml
ğŸ§‘â€ğŸ“ ìºë¦­í„° ê´€ë¦¬
\`\`\`
**\`!ì‹œíŠ¸ì…ë ¥ [ì´ë¦„] [íŠ¹ê¸°1] [íŠ¹ê¸°2] [íŠ¹ê¸°3] [íŠ¹ê¸°4] [íŠ¹ê¸°5]\`**  
ìºë¦­í„°ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. íŠ¹ê¸° 5ê°œë¥¼ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.  
ì˜ˆì‹œ: \`!ì‹œíŠ¸ì…ë ¥ ì´ì†”ë › ì²œê³µ ê½ƒ ì„ ìœ¨ ì‚¬ë‘ ì \`  

**\`!ì‹œíŠ¸ì‚­ì œ\`** - í˜„ì¬ ìºë¦­í„° ì •ë³´ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.  
**\`!ì§€ì •\`** - ì„œë²„ë³„ë¡œ ì‚¬ìš©í•  ìºë¦­í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.  
**\`!ì§€ì •í•´ì œ\`** - í˜„ì¬ ì„œë²„ì—ì„œ ìºë¦­í„°ë¥¼ í•´ì œí•©ë‹ˆë‹¤.  
**\`!ê¸°ê´€ [ì›íƒ/ì²œì• /í•™ì›/ë¬¸í˜¸/ì—½ê·€/ì•„ë°©ê¶]\`** - ìºë¦­í„°ì˜ ê¸°ê´€ì„ ì„¤ì •í•©ë‹ˆë‹¤.  
**\`!ê³„ì œ [1~7]\`** - ìºë¦­í„°ì˜ ê³„ì œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (ê¸°ë³¸ê°’: 3)  
**\`!ìœ„ê³„ [ì„œê²½/ì‚¬ì„œ/ì„œê³µ/ë°©ë¬¸ì/ì´ë‹¨ì/ì™¸ì „]\`** - ìºë¦­í„°ì˜ ìœ„ê³„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.  
`
    );

    await message.reply(
        `ğŸ“œ **MGLGbot ëª…ë ¹ì–´ ëª©ë¡ (2/2)**  
\`\`\`yaml
ğŸ“– íŠ¹ê¸° ë° ì˜ì—­ ê´€ë¦¬
\`\`\`
**\`!íŠ¹ê¸°ì„¤ì • [íŠ¹ê¸°1] [íŠ¹ê¸°2] [íŠ¹ê¸°3] [íŠ¹ê¸°4] [íŠ¹ê¸°5]\`**  
íŠ¹ê¸°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì´ 5ê°œ)  
ì˜ˆì‹œ: \`!íŠ¹ê¸°ì„¤ì • ì²œê³µ ê½ƒ ì„ ìœ¨ ì‚¬ë‘ ì \`  

**\`!íŠ¹ê¸°í™•ì¸\`** - í˜„ì¬ ì„¤ì •ëœ íŠ¹ê¸°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.  
**\`!ì˜ì—­ [ë³„/ì§ìŠ¹/í˜/ë…¸ë˜/ê¿ˆ/ì–´ë‘ ]\`** - ìºë¦­í„°ì˜ ì˜ì—­ì„ ì„¤ì •í•©ë‹ˆë‹¤.  

\`\`\`yaml
ğŸ² íŒì • ì‹œìŠ¤í…œ
\`\`\`
**\`!íŒì • [íŠ¹ê¸°]\`** - íŠ¹ì • íŠ¹ê¸°ë¡œ íŒì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
ì˜ˆì‹œ: \`!íŒì • ì²œê³µ\`  

**\`!ì¥ì„œ [ì¥ì„œëª…]\`** - ë³´ìœ í•œ ì¥ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ íŒì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
ì˜ˆì‹œ: \`!ì¥ì„œ "ë§ˆê²€ ì†Œí™˜"\`  

\`\`\`yaml
ğŸ“œ ì¥ì„œ ê´€ë¦¬
\`\`\`
**\`!ì¥ì„œì¶”ê°€ "ì¥ì„œëª…" [íŒì •íŠ¹ê¸°] [ë§ˆì†Œì˜ì—­][ì½”ìŠ¤íŠ¸] [ì„¤ëª…]\`**  
ìƒˆë¡œìš´ ì¥ì„œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.  
ì˜ˆì‹œ: \`!ì¥ì„œì¶”ê°€ "ë§ˆê²€ ì†Œí™˜" ì„ ìœ¨ ë…¸ë˜2 ê°•ë ¥í•œ ê²€ì„ ì†Œí™˜í•œë‹¤.\`  

**\`!ì¥ì„œì‚­ì œ "ì¥ì„œëª…"\`** - íŠ¹ì • ì¥ì„œë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.  
**\`!ì¥ì„œë¦¬ì…‹\`** - ëª¨ë“  ì¥ì„œë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)  
**\`!ì¥ì„œëª©ë¡\`** - í˜„ì¬ ë³´ìœ í•œ ì¥ì„œ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.  
`
    );
}
});

// Register Slash Commands
const commands = [
    new SlashCommandBuilder()
        .setName('í”Œë¡¯')
        .setDescription('í”Œë¡¯ì„ ì„¤ì •í•©ë‹ˆë‹¤.')
        .addStringOption(option =>
            option.setName('ê°’')
                .setDescription('1~6 ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: 1 3 5')
                .setRequired(true))
].map(command => command.toJSON());

// 12ì‹œê°„ë§ˆë‹¤ BCdicebot#8116ì—ê²Œ ëª…ë ¹ì–´ ì „ì†¡
const targetBotTag = "BCdicebot#8116";
const diceCommand = "bcdice set MagicaLogia:Korean";
const interval = 12 * 60 * 60 * 1000; // 12ì‹œê°„ ê°„ê²© (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)

setInterval(() => {
    client.guilds.cache.forEach(guild => {
        const targetBot = guild.members.cache.find(member => member.user.tag === targetBotTag);
        if (targetBot) {
            const textChannel = guild.channels.cache.find(channel => 
                channel.type === 0 && channel.permissionsFor(client.user).has("SEND_MESSAGES")
            );
            if (textChannel) {
                textChannel.send(diceCommand)
                    .then(() => console.log(`âœ… BCdicebotì„ ê¹¨ì› ìŠµë‹ˆë‹¤: ${guild.name}`))
                    .catch(err => console.error(`âŒ BCdicebot ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨ (${guild.name}):`, err));
            }
        }
    });
}, interval);

// í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë´‡ í† í° ê°€ì ¸ì˜¤ê¸°
const token = process.env.DISCORD_BOT_TOKEN;

if (!token) {
    console.error("âŒ DISCORD_BOT_TOKEN í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!");
    process.exit(1); // í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ ì‹¤í–‰ ì¤‘ì§€
}

client.login(token);
console.log("âœ… ë””ìŠ¤ì½”ë“œ ë´‡ì´ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!");
